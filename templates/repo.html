{{template "head" .}}

<main class="container">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <div style="display: flex; align-items: center; gap: 12px;">
            <h1 style="font-size: 20px;">
                <a href="/" style="color: var(--text-secondary);">repos</a>
                <span style="color: var(--text-secondary); margin: 0 4px;">/</span>
                <a href="/{{.RepoName}}">{{.RepoName}}</a>
            </h1>
            {{if .IsPublic}}
            <span class="badge badge-public">public</span>
            {{else}}
            <span class="badge badge-private">private</span>
            {{end}}
            {{if .PagesEnabled}}
            <a href="{{.PagesURL}}" target="_blank" rel="noopener" class="badge" style="background: var(--link); color: white; text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
                <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25ZM6.5 6.5v8h7.75a.25.25 0 0 0 .25-.25V6.5Zm8-1.5V1.75a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25V5Zm-8 10v-8H1.5v7.75c0 .138.112.25.25.25Z"/>
                </svg>
                pages
            </a>
            {{end}}
        </div>
        {{if .IsTailnet}}
        <a href="/{{.RepoName}}/settings" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text); text-decoration: none; font-size: 13px;">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.04.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.103-.303c-.066-.019-.176-.011-.299.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.212.224l-.288 1.107c-.17.645-.715 1.195-1.459 1.26a8.006 8.006 0 0 1-1.402 0c-.744-.065-1.289-.615-1.459-1.26l-.288-1.107c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.049-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.04-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.103.303c.066.019.176.011.299-.071.214-.143.437-.272.668-.386.133-.066.194-.158.212-.224L5.84 1.29c.17-.645.715-1.195 1.459-1.26A8.094 8.094 0 0 1 8 0ZM5.5 8a2.5 2.5 0 1 0 5 0 2.5 2.5 0 0 0-5 0Z"/>
            </svg>
            Settings
        </a>
        {{end}}
    </div>

    {{if .IsEmpty}}
    <!-- Empty Repository Guide -->
    <div class="card" style="padding: 32px; text-align: center; margin-bottom: 24px;">
        <svg width="64" height="64" viewBox="0 0 16 16" fill="currentColor" style="color: var(--text-secondary); margin-bottom: 16px;">
            <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.249.249 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z"/>
        </svg>
        <h2 style="font-size: 18px; margin-bottom: 8px;">This repository is empty</h2>
        <p style="color: var(--text-secondary); margin-bottom: 24px;">Get started by creating a new file or pushing an existing repository.</p>
    </div>

    <div class="card" style="padding: 24px;">
        <h3 style="font-size: 16px; margin-bottom: 16px;">Quick setup</h3>

        <div style="margin-bottom: 24px;">
            <h4 style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Create a new repository on the command line</h4>
            <pre style="padding: 12px; overflow-x: auto; font-size: 13px;">echo "# {{.RepoName}}" >> README.md
git init
git add README.md
git commit -m "Initial commit"
git branch -M main
git remote add origin git@{{.TailnetURL}}:{{.RepoName}}.git
git push -u origin main</pre>
        </div>

        <div style="margin-bottom: 24px;">
            <h4 style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Push an existing repository from the command line</h4>
            <pre style="padding: 12px; overflow-x: auto; font-size: 13px;">git remote add origin git@{{.TailnetURL}}:{{.RepoName}}.git
git branch -M main
git push -u origin main</pre>
        </div>

        {{if .IsTailnet}}
        <div style="padding-top: 16px; border-top: 1px solid var(--border);">
            <h4 style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Clone URL</h4>
            <pre style="padding: 12px; margin: 0;">git@{{.TailnetURL}}:{{.RepoName}}.git</pre>
        </div>
        {{end}}
    </div>
    {{else}}
    <nav style="display: flex; gap: 24px; border-bottom: 1px solid var(--border); margin-bottom: 16px;">
        <a href="/{{.RepoName}}/tree/{{.Ref}}/" class="active" style="padding: 8px 0; border-bottom: 2px solid var(--link); margin-bottom: -1px;">
            Files
        </a>
        <a href="/{{.RepoName}}/commits/{{.Ref}}" style="padding: 8px 0; color: var(--text-secondary);">
            Commits
        </a>
    </nav>

    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
        <select onchange="window.location.href='/{{.RepoName}}/tree/' + this.value + '/{{.Path}}'">
            {{range .Branches}}
            <option value="{{.}}" {{if eq . $.Ref}}selected{{end}}>{{.}}</option>
            {{end}}
        </select>

        <div style="display: flex; align-items: center; gap: 4px; color: var(--text-secondary);">
            <a href="/{{.RepoName}}/tree/{{.Ref}}/" style="color: var(--text-secondary);">{{.RepoName}}</a>
            {{range .Breadcrumbs}}
            <span>/</span>
            {{if .Path}}
            <a href="/{{$.RepoName}}/tree/{{$.Ref}}/{{.Path}}" style="color: var(--text-secondary);">{{.Name}}</a>
            {{else}}
            <span style="color: var(--text);">{{.Name}}</span>
            {{end}}
            {{end}}
        </div>
    </div>

    <div class="card">
        <table style="width: 100%; border-collapse: collapse;">
            {{range .Entries}}
            <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 8px 16px; width: 24px;">
                    {{if .IsSubmodule}}
                    <!-- Submodule icon: folder with arrow -->
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color: #8250df;">
                        <path d="M0 2.75C0 1.784.784 1 1.75 1H5c.55 0 1.07.26 1.4.7l.9 1.2a.25.25 0 0 0 .2.1h6.75c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm9.42 9.36 2.883-2.677a.25.25 0 0 0 0-.366L9.42 6.39a.249.249 0 0 0-.42.183V8.5H4.75a.75.75 0 0 0 0 1.5H9v1.927c0 .218.26.331.42.183Z"/>
                    </svg>
                    {{else if .IsDir}}
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color: var(--link);">
                        <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"/>
                    </svg>
                    {{else}}
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color: var(--text-secondary);">
                        <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/>
                    </svg>
                    {{end}}
                </td>
                <td style="padding: 8px 16px;">
                    {{if .IsSubmodule}}
                    {{$sub := index $.Submodules .Name}}
                    <a href="/{{$.RepoName}}/submodule/{{$.Ref}}/{{if $.Path}}{{$.Path}}/{{end}}{{.Name}}">{{.Name}}</a>
                    <span style="color: var(--text-secondary); margin-left: 8px; font-family: ui-monospace, monospace; font-size: 12px;">@ {{truncate .Hash 8}}</span>
                    {{if $sub}}{{if $sub.WebURL}}
                    <a href="{{$sub.WebURL}}" target="_blank" rel="noopener" style="margin-left: 8px; color: var(--text-secondary);" title="View external repo">
                        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"/>
                        </svg>
                    </a>
                    {{end}}{{end}}
                    {{else if .IsDir}}
                    <a href="/{{$.RepoName}}/tree/{{$.Ref}}/{{if $.Path}}{{$.Path}}/{{end}}{{.Name}}">{{.Name}}</a>
                    {{else}}
                    <a href="/{{$.RepoName}}/blob/{{$.Ref}}/{{if $.Path}}{{$.Path}}/{{end}}{{.Name}}">{{.Name}}</a>
                    {{end}}
                </td>
            </tr>
            {{end}}
        </table>
    </div>

    {{if .ReadmeHTML}}
    <div class="card" style="margin-top: 16px;">
        <div style="padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color: var(--text-secondary);">
                <path d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Zm7.251 10.324.004-5.073-.002-2.253A2.25 2.25 0 0 0 5.003 2.5H1.5v9h3.757a3.75 3.75 0 0 1 1.994.574ZM8.755 4.75l-.004 7.322a3.752 3.752 0 0 1 1.992-.572H14.5v-9h-3.495a2.25 2.25 0 0 0-2.25 2.25Z"/>
            </svg>
            <span style="font-weight: 500;">{{.ReadmeName}}</span>
        </div>
        <div class="markdown-body" style="padding: 16px;">
            {{.ReadmeHTML}}
        </div>
    </div>
    {{end}}

    <div style="margin-top: 24px; padding: 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px;">
        <h3 style="font-size: 14px; margin-bottom: 12px;">Clone</h3>
        {{if .IsTailnet}}
        <div style="margin-bottom: 8px;">
            <code style="font-size: 13px; color: var(--text-secondary);">SSH (read/write)</code>
        </div>
        <pre style="margin: 0; padding: 8px 12px;">git clone git@{{.TailnetURL}}:{{.RepoName}}.git</pre>
        {{end}}
        {{if .IsPublic}}
        <div style="margin-top: 12px; margin-bottom: 8px;">
            <code style="font-size: 13px; color: var(--text-secondary);">HTTPS (read-only)</code>
        </div>
        <pre style="margin: 0; padding: 8px 12px;">git clone {{.PublicURL}}/{{.RepoName}}.git</pre>
        {{end}}
    </div>
    {{end}}
</main>

{{template "footer" .}}
