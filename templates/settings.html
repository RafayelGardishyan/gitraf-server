{{template "head" .}}

<main class="container">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
        <h1 style="font-size: 20px;">
            <a href="/" style="color: var(--text-secondary);">repos</a>
            <span style="color: var(--text-secondary); margin: 0 4px;">/</span>
            <a href="/{{.RepoName}}">{{.RepoName}}</a>
            <span style="color: var(--text-secondary); margin: 0 4px;">/</span>
            <span>Settings</span>
        </h1>
    </div>

    <form method="POST" action="/{{.RepoName}}/settings">
        <!-- General Settings -->
        <div class="card" style="padding: 24px; margin-bottom: 16px;">
            <h2 style="font-size: 18px; margin-bottom: 20px;">General</h2>

            <div style="margin-bottom: 20px;">
                <label for="description" style="display: block; font-weight: 500; margin-bottom: 8px;">
                    Description
                </label>
                <input type="text" id="description" name="description" value="{{.Description}}"
                       placeholder="Short description of your repository"
                       style="width: 100%; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 14px;">
            </div>

            <div>
                <label style="display: block; font-weight: 500; margin-bottom: 12px;">Visibility</label>

                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <label style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer;">
                        <input type="radio" name="visibility" value="private" {{if not .IsPublic}}checked{{end}} style="margin-top: 4px;">
                        <div>
                            <div style="font-weight: 500; display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 4a4 4 0 0 1 8 0v2h.25c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 12.25 15h-8.5A1.75 1.75 0 0 1 2 13.25v-5.5C2 6.784 2.784 6 3.75 6H4Zm8.25 3.5h-8.5a.25.25 0 0 0-.25.25v5.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25ZM10.5 6V4a2.5 2.5 0 1 0-5 0v2Z"/>
                                </svg>
                                Private
                            </div>
                            <div style="color: var(--text-secondary); font-size: 13px;">
                                Only accessible via tailnet
                            </div>
                        </div>
                    </label>

                    <label style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer;">
                        <input type="radio" name="visibility" value="public" {{if .IsPublic}}checked{{end}} style="margin-top: 4px;">
                        <div>
                            <div style="font-weight: 500; display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.249.249 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z"/>
                                </svg>
                                Public
                            </div>
                            <div style="color: var(--text-secondary); font-size: 13px;">
                                Anyone can view via HTTPS (read-only)
                            </div>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Pages Settings -->
        <div class="card" style="padding: 24px; margin-bottom: 16px;">
            <h2 style="font-size: 18px; margin-bottom: 8px;">Pages</h2>
            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
                Deploy static sites from this repository to <code>{{.RepoName}}.yourdomain.com</code>
            </p>

            <div style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                    <input type="checkbox" name="pages_enabled" id="pages_enabled" {{if .PagesEnabled}}checked{{end}}
                           onchange="document.getElementById('pages-config').style.display = this.checked ? 'block' : 'none'">
                    <span style="font-weight: 500;">Enable Pages</span>
                </label>
            </div>

            <div id="pages-config" style="{{if not .PagesEnabled}}display: none;{{end}} padding-left: 24px; border-left: 2px solid var(--border);">
                <div style="margin-bottom: 16px;">
                    <label for="pages_branch" style="display: block; font-weight: 500; margin-bottom: 8px;">
                        Branch
                    </label>
                    <select name="pages_branch" id="pages_branch"
                            style="padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 14px;">
                        {{range .Branches}}
                        <option value="{{.}}" {{if eq . $.PagesBranch}}selected{{end}}>{{.}}</option>
                        {{end}}
                        {{if not .Branches}}
                        <option value="main" {{if eq "main" $.PagesBranch}}selected{{end}}>main</option>
                        {{end}}
                    </select>
                </div>

                <div style="margin-bottom: 16px;">
                    <label for="pages_build_cmd" style="display: block; font-weight: 500; margin-bottom: 8px;">
                        Build command <span style="color: var(--text-secondary); font-weight: normal;">(optional)</span>
                    </label>
                    <input type="text" id="pages_build_cmd" name="pages_build_cmd" value="{{.PagesBuildCmd}}"
                           placeholder="npm run build"
                           style="width: 100%; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 14px; font-family: monospace;">
                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                        Leave empty for static sites with no build step
                    </p>
                </div>

                <div>
                    <label for="pages_output_dir" style="display: block; font-weight: 500; margin-bottom: 8px;">
                        Output directory
                    </label>
                    <input type="text" id="pages_output_dir" name="pages_output_dir" value="{{.PagesOutputDir}}"
                           placeholder="public"
                           style="width: 100%; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 14px; font-family: monospace;">
                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                        Directory containing your site files (e.g., public, dist, build)
                    </p>
                </div>
            </div>
        </div>

        <!-- Mirror Settings -->
        <div class="card" style="padding: 24px; margin-bottom: 16px;">
            <h2 style="font-size: 18px; margin-bottom: 8px;">GitHub Mirror</h2>
            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
                Automatically sync this repository to a GitHub mirror for backup or collaboration
            </p>

            <div style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                    <input type="checkbox" name="mirror_enabled" id="mirror_enabled" {{if .MirrorEnabled}}checked{{end}}
                           onchange="document.getElementById('mirror-config').style.display = this.checked ? 'block' : 'none'">
                    <span style="font-weight: 500;">Enable GitHub Mirroring</span>
                </label>
            </div>

            <div id="mirror-config" style="{{if not .MirrorEnabled}}display: none;{{end}} padding-left: 24px; border-left: 2px solid var(--border);">
                <div>
                    <label for="mirror_url" style="display: block; font-weight: 500; margin-bottom: 8px;">
                        GitHub SSH URL
                    </label>
                    <input type="text" id="mirror_url" name="mirror_url" value="{{.MirrorURL}}"
                           placeholder="git@github.com:username/repo.git"
                           style="width: 100%; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 14px; font-family: monospace;">
                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                        SSH URL of your GitHub repository (e.g., git@github.com:user/repo.git)
                    </p>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 6px;">
                    <p style="font-size: 13px; color: var(--text-secondary);">
                        <strong style="color: var(--text);">Note:</strong> Mirroring requires the server's SSH key to be added to your GitHub account.
                        Use <code>gitraf mirror cron enable</code> to set up automatic syncing.
                    </p>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div style="display: flex; gap: 12px;">
            <button type="submit" style="padding: 10px 20px; background: var(--link); color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer;">
                Save changes
            </button>
            <a href="/{{.RepoName}}" style="padding: 10px 20px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; font-size: 14px; color: var(--text); text-decoration: none;">
                Cancel
            </a>
        </div>
    </form>
</main>

{{template "footer" .}}
